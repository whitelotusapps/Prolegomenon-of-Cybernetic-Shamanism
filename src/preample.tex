% === PREAMBLE.TEX ===
% Shared preamble for all documents

% === VERSION CONTROL PANEL ===
% --- Main Document ---
\newcommand{\prolegomenonVersion}{v1.2.1}               % Prelegomenon

% --- Foundational Corpus: Case Studies & Evidence ---
\newcommand{\csSacredPruningVersion}{v1.0.2}            % Case Study 1
\newcommand{\csNewtonJungTribeVersion}{v1.0.2}          % Case Study 2
\newcommand{\csLiveTestVersion}{v1.0.1}                 % Case Study 3
\newcommand{\csMultiSystemValidationVersion}{v1.1.0}    % Case Study 4
\newcommand{\csSovereignChoicePointVersion}{v1.0.2}     % Case Study 5
\newcommand{\csMetaDialogueVersion}{v1.0.2}             % Case Study 6
\newcommand{\csTheUniverseSpeakingtoItself}{v1.0.1}     % Case Study 7
% =============================

\usepackage{tocloft}
\setlength{\cftbeforesecskip}{1em}
\setlength{\cftbeforesubsecskip}{0.5em}
\setlength{\cftbeforesubsubsecskip}{0.2em}

\usepackage{titlesec}
\titlespacing*{\section}      {0pt}{1.5\baselineskip}{0\baselineskip}
\titlespacing*{\subsection}   {0pt}{1\baselineskip}{0\baselineskip}
\titlespacing*{\subsubsection}{0pt}{0.5\baselineskip}{0\baselineskip}

\usepackage{enumitem}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{refcount}
\usepackage{needspace}
\usepackage[hidelinks, plainpages=false]{hyperref}
\usepackage{etoolbox} % Required for \pretocmd

% Allow documents to define these or fall back to defaults
\providecommand{\docTitle}{Untitled Document}
\providecommand{\docAuthor}{Anonymous}
\providecommand{\docVersion}{v0.0.0}
\providecommand{\docYear}{\the\year}

% --- License ---
\newcommand{\licenseText}{License: CC BY-NC-SA 4.0}
\newcommand{\licenseURL}{https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode.txt}

% --- Footer for main body ---
\fancypagestyle{mainbody}{
    \fancyhf{}
    \fancyfoot[L]{\docVersion}
    \fancyfoot[C]{\href{\licenseURL}{\licenseText}}
    \fancyfoot[R]{Page \thepage\ of \pageref*{LastPage}}
}

% --- Footer for front matter ---
\fancypagestyle{plain}{
    \fancyhf{}
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0.4pt}
    \fancyfoot[L]{\docVersion}
    \fancyfoot[C]{\href{\licenseURL}{\licenseText}}
    \fancyfoot[R]{Page \thepage\ of \romannumeral\getpagerefnumber{LastFrontMatterPage}}
}

\setlength{\parskip}{1em}
\setlength{\parindent}{0pt}
\renewcommand{\footrulewidth}{0.4pt}
\renewcommand{\headrulewidth}{0pt}

% ToC + hyperlink fixes
\pretocmd{\section}{\phantomsection}{}{}
\pretocmd{\subsection}{\phantomsection}{}{}
\pretocmd{\subsubsection}{\phantomsection}{}{}
